cmake_minimum_required(VERSION 3.9)
project(xendbg)

set(CMAKE_CXX_STANDARD 17)
set(CLANG_DEFAULT_CXX_STDLIB "libc++")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -stdlib=libc++")

include_directories(
  include
  third_party/CLI11/include
  third_party/ELFIO/include)

add_executable(xendbg
  include/Debugger/DebugSession.hpp
  include/Debugger/DebugSession.hpp
  include/Debugger/DebugSessionPV.hpp
  include/GDBServer/GDBConnection.hpp
  include/GDBServer/GDBPacketInterpreter.hpp
  include/GDBServer/GDBPacketQueue.hpp
  include/GDBServer/GDBRequestPacket.hpp
  include/GDBServer/GDBResponsePacket.hpp
  include/GDBServer/GDBServer.hpp
  include/Registers/Register.hpp
  include/Registers/RegisterContext.hpp
  include/Registers/RegistersX86.hpp
  include/Registers/RegistersX86Any.hpp
  include/Registers/RegistersX86_64.hpp
  include/UV/UVIdle.hpp
  include/UV/UVLoop.hpp
  include/UV/UVPoll.hpp
  include/UV/UVSignal.hpp
  include/UV/UVTCP.hpp
  include/UV/UVTimer.hpp
  include/Util/clear.hpp
  include/Util/overloaded.hpp
  include/Util/pop_ret.hpp
  include/Util/string.hpp
  include/Xen/BridgeHeaders/domctl.h
  include/Xen/BridgeHeaders/xenctrl.h
  include/Xen/BridgeHeaders/xenforeignmemory.h
  include/Xen/BridgeHeaders/xenguest.h
  include/Xen/BridgeHeaders/xenstore.h
  include/Xen/Common.hpp
  include/Xen/Domain.hpp
  include/Xen/PageTableEntry.hpp
  include/Xen/PrivCmd.hpp
  include/Xen/XenCtrl.hpp
  include/Xen/XenEventChannel.hpp
  include/Xen/XenException.hpp
  include/Xen/XenForeignMemory.hpp
  include/Xen/XenHandle.hpp
  include/Xen/XenStore.hpp
  src/CommandLine.cpp
  src/CommandLine.hpp
  src/Debugger/DebugSession.cpp
  src/GDBServer/GDBConnection.cpp
  src/GDBServer/GDBPacketInterpreter.cpp
  src/GDBServer/GDBPacketQueue.cpp
  src/GDBServer/GDBServer.cpp
  src/ServerModeController.cpp
  src/ServerModeController.hpp
  src/UV/UVIdle.cpp
  src/UV/UVLoop.cpp
  src/UV/UVPoll.cpp
  src/UV/UVSignal.cpp
  src/UV/UVTCP.cpp
  src/UV/UVTimer.cpp
  src/Xen/Domain.cpp
  src/Xen/PageTableEntry.cpp
  src/Xen/PrivCmd.cpp
  src/Xen/XenCtrl.cpp
  src/Xen/XenEventChannel.cpp
  src/Xen/XenForeignMemory.cpp
  src/Xen/XenHandle.cpp
  src/Xen/XenStore.cpp
  src/main.cpp
  src/Debugger/DebugSession.cpp
  src/Debugger/DebugSessionPV.cpp
)

target_link_libraries(xendbg
  capstone
  pthread
  readline
  uv
  xenctrl
  xenevtchn
  xenforeignmemory
  xenlight
  xenstore
  xlutil)
