cmake_minimum_required(VERSION 3.9)
project(xendbg)

set(CMAKE_CXX_STANDARD 17)
set(CLANG_DEFAULT_CXX_STDLIB "libc++")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -stdlib=libc++")

include_directories(
  third_party/CLI11/include
  third_party/ELFIO/include
  third_party/sunrise/)

add_executable(xendbg
  src/Debugger/DebugSession.cpp
  src/Debugger/DebugSession.hpp
  src/Debugger/DebugSessionPV.cpp
  src/Debugger/DebugSessionPV.hpp
        src/GDBServer/GDBPacketIO.cpp
        src/GDBServer/GDBPacketIO.hpp
        src/GDBServer/GDBRequestPacket.hpp
        src/GDBServer/GDBResponsePacket.hpp
        src/GDBServer/GDBStub.cpp
        src/GDBServer/GDBStub.hpp
  src/REPL/Command/Action.hpp
  src/REPL/Command/ArgsHandle.cpp
  src/REPL/Command/ArgsHandle.hpp
  src/REPL/Command/Argument.cpp
  src/REPL/Command/Argument.hpp
  src/REPL/Command/Command.cpp
  src/REPL/Command/Command.hpp
  src/REPL/Command/CommandBase.hpp
  src/REPL/Command/CommandVerb.cpp
  src/REPL/Command/CommandVerb.hpp
  src/REPL/Command/Flag.cpp
  src/REPL/Command/Flag.hpp
  src/REPL/Command/FlagsHandle.cpp
  src/REPL/Command/FlagsHandle.hpp
  src/REPL/Command/MakeCommand.cpp
  src/REPL/Command/MakeCommand.hpp
  src/REPL/Command/Match.cpp
  src/REPL/Command/Match.hpp
  src/REPL/Command/MatchHelper.hpp
  src/REPL/Command/Verb.cpp
  src/REPL/Command/Verb.hpp
  src/REPL/Parser/Expression/Expression.hpp
  src/REPL/Parser/Expression/ExpressionGeneric.hpp
  src/REPL/Parser/Expression/Operator/BinaryOperator.hpp
  src/REPL/Parser/Expression/Operator/Precedence.hpp
  src/REPL/Parser/Expression/Operator/UnaryOperator.hpp
  src/REPL/Parser/Parser.cpp
  src/REPL/Parser/ParserException.hpp
  src/REPL/Parser/Predicate.hpp
  src/REPL/Parser/Sentinel.hpp
  src/REPL/Parser/Token/Label.hpp
  src/REPL/Parser/Token/Match.hpp
  src/REPL/Parser/Token/String.hpp
  src/REPL/Parser/Token/Symbol.hpp
  src/REPL/Parser/Token/Variable.hpp
  src/REPL/Parser/Tokenizer.hpp
  src/REPL/REPL.cpp
  src/REPL/REPL.hpp
  src/Registers/Register.hpp
  src/Registers/RegisterContext.hpp
        src/Registers/RegistersX86.hpp
  src/Registers/RegistersX86_64.hpp
  src/Util/IndentHelper.cpp
  src/Util/IndentHelper.hpp
  src/Util/clear.hpp
  src/Util/overloaded.hpp
  src/Util/pop_ret.hpp
  src/Util/string.cpp
  src/Util/string.hpp
  src/Xen/BridgeHeaders/domctl.h
  src/Xen/BridgeHeaders/xenctrl.h
  src/Xen/BridgeHeaders/xenforeignmemory.h
  src/Xen/BridgeHeaders/xenguest.h
  src/Xen/BridgeHeaders/xenstore.h
  src/Xen/Common.hpp
  src/Xen/Domain.cpp
  src/Xen/Domain.hpp
  src/Xen/MemoryPermissions.cpp
  src/Xen/PrivCmd.cpp
  src/Xen/PrivCmd.hpp
  src/Xen/XenCtrl.cpp
  src/Xen/XenCtrl.hpp
  src/Xen/XenException.hpp
  src/Xen/XenForeignMemory.cpp
  src/Xen/XenForeignMemory.hpp
  src/Xen/XenHandle.hpp
  src/Xen/XenStore.cpp
  src/Xen/XenStore.hpp
  src/main.cpp src/Xen/XenHandle.cpp src/CommandLine.cpp src/CommandLine.hpp src/Debugger/DebugSession.cpp src/Debugger/DebugSession.hpp src/GDBServer/GDBPacketQueue.cpp src/GDBServer/GDBPacketQueue.hpp src/GDBServer/GDBServer.cpp src/GDBServer/GDBServer.hpp)

target_link_libraries(xendbg
  capstone
  pthread
  readline
  uv
  xenctrl
  xenforeignmemory
  xenlight
  xenstore
  xlutil)
